---
- name: bootstrap ssh certificates
  hosts: localhost
  gather_facts: false
  vars:
    ansible_user: root
    artifact_dir: artifacts
    vault_ca_path: "{{ artifact_dir }}/trusted-user-ca-keys.pem"
    vault_client_keypair_path: ~/.ssh/id_homelab
    vault_url: https://vault.angrydonkey.io
  tasks:
    - ansible.builtin.import_tasks: _bootstrap_vault.yaml
- name: update trusted user ca on baremetal hosts
  hosts: proxmox
  gather_facts: true
  vars:
    artifact_dir: artifacts
    vault_ca_path: "{{ artifact_dir }}/trusted-user-ca-keys.pem"
  tasks:
    - include_tasks: _bootstrap_unraid.yaml
      when: ansible_facts['kernel'] is search('Unraid')
    - include_tasks: _bootstrap_debian.yaml
      when: ansible_facts['os_family'] == "Debian"
